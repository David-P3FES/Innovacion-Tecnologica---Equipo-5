{% load static %}
<!--!
  @file base.html
  @brief Plantilla base con header, footer y bloques extendibles.
  @details
   - Define la estructura principal de la web (header, contenido, footer).
   - Incluye bloques `block` de Django para sobreescribir contenido en otras plantillas.
   - Usa estilos globales, íconos FontAwesome y fuente Poppins.
-->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta name="csrf-token" content="{{ csrf_token }}">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>{% block title %}ViviendaYA!{% endblock %}</title>

  <!--! @section css_global CSS global -->
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">

  <meta name="csrf-token" content="{{ csrf_token }}"/>

  {% block extra_head %}{% endblock %}
  {% block extra_css %}{% endblock %}
</head>
<body>
  <!--! @section header Encabezado principal -->
  <header class="header" role="banner">
    <div class="header-content">
      <div class="zona-izquierda">
        <h1 class="nombre-sitio">
          <a href="{% url 'principal:home' %}" class="logo-link" aria-label="Ir al inicio">ViviendaYa!</a>
        </h1>
      </div>

      <div class="zona-derecha">
        <nav class="navbar-actions" role="navigation" aria-label="Principal">

          {% if user.is_authenticated %}
            
            {% if request.resolver_match.url_name == 'ver_perfil' %}
              <a href="{% url 'principal:home' %}" class="btn-login">
                <i class="fas fa-home"></i> Inicio
              </a>
              <a href="{% url 'principal:mis_favoritos' %}" class="btn-login">
                <i class="fas fa-heart"></i> Me encantas
              </a>
              <a href="{% url 'publicaciones:panel' %}" class="btn-login">
                <i class="fas fa-house-circle-check"></i>Vender/Rentar
              </a>
            {% else %}
              <a href="{% url 'principal:mis_favoritos' %}" class="btn-login">
                <i class="fas fa-heart"></i> Mis favoritos
              </a>
              <a href="{% url 'publicaciones:panel' %}" class="btn-login">
                <i class="fas fa-home"></i> Vender/Rentar
              </a>
            {% endif %}
            
            <div class="user-menu">
              <div class="trigger-wrap">
                <button class="avatar-btn" type="button" aria-haspopup="true" aria-expanded="false" aria-label="Abrir menú de usuario">
                  <div class="avatar-circle">
                    {% with base=user.first_name|default:user.username %}
                      <span class="avatar-initial">{{ base|slice:":1"|upper }}</span>
                    {% endwith %}
                  </div>
                </button>
                
                <button class="caret-btn" type="button" aria-label="Abrir menú de usuario"></button>
              </div>

              <div class="user-dropdown" role="menu" aria-label="Menú de usuario">
                <a href="{% url 'cuentas:ver_perfil' %}" role="menuitem">
                  <i class="fas fa-id-card"></i> Ver perfil
                </a>
                <a href="{% url 'account_logout' %}" role="menuitem">
                  <i class="fas fa-sign-out-alt"></i> Salir
                </a>
              </div>
            </div>


          {% else %}
            <a href="{% url 'account_login' %}" class="btn-login">
              <i class="fas fa-user"></i> Iniciar sesión
            </a>
          {% endif %}
        </nav>
      </div>
    </div>
  </header>
  <!--! @endsection header -->

  <!--! @section top_banner Banner superior opcional -->
  {% block top_banner %}{% endblock %}

  <!--! @section main Contenido principal -->
  <main class="contenido-pagina">
    {% block content %}{% endblock %}
  </main>
  <!--! @endsection main -->

  <!--! @section footer Pie de página -->
  <footer class="footer" role="contentinfo">
    <div class="footer-wrap">
      <div class="footer-col brand">
        <div class="brand-row">
          <span class="brand-mark">V</span>
          <span class="brand-name">ViviendaYa!</span>
        </div>
        <p>
          Tu socio confiable en el mercado inmobiliario.<br>
          Conectamos personas con sus hogares ideales.
        </p>
      </div>

      <div class="footer-col">
        <h4>Servicios</h4>
        <ul>
          <li><p>Comprar propiedades</p></li>
          <li><p>Rentar propiedades</p></li>
          <li><p>Vender tu propiedad</p></li>
        </ul>
      </div>

      <div class="footer-col">
        <h4>Soporte</h4>
        <ul>
          <li><a href="#">Centro de ayuda</a></li>
          <li><a href="#">Términos de uso</a></li>
          <li><a href="#">Política de privacidad</a></li>
        </ul>
      </div>

      <div class="footer-col contact">
        <h4>Contacto</h4>
        <ul>
          <li><i class="fas fa-phone"></i> +1800 0000</li>
          <li><i class="fas fa-envelope"></i> viviendayamx@gmail.com</li>
          <li><i class="fas fa-location-dot"></i> ViviendaYa!</li>
        </ul>
      </div>
    </div>

    <div class="footer-bar">
      <p>© 2025 ViviendaYA! | Todos los derechos reservados</p>
      <p>Desarrollado con <span class="heart">❤</span> para encontrar tu hogar ideal</p>
    </div>
  </footer>
  <!--! @endsection footer -->

  <!--! @section extra_js Scripts adicionales -->
  {% block extra_js %}
  <script>
document.addEventListener('DOMContentLoaded', () => {
  const menus = document.querySelectorAll('.user-menu');

  const closeAll = () => menus.forEach(m => m.classList.remove('open'));

  menus.forEach(menu => {
    const avatarBtn = menu.querySelector('.avatar-btn');
    const caretBtn  = menu.querySelector('.caret-btn');

    const toggle = (open) => {
      closeAll();
      menu.classList.toggle('open', open);
      if (avatarBtn) avatarBtn.setAttribute('aria-expanded', open ? 'true' : 'false');
    };

    const onTriggerClick = (e) => {
      e.stopPropagation();
      toggle(!menu.classList.contains('open'));
    };

    if (avatarBtn) avatarBtn.addEventListener('click', onTriggerClick);
    if (caretBtn)  caretBtn.addEventListener('click', onTriggerClick);

    document.addEventListener('click', (e) => {
      if(!menu.contains(e.target)) menu.classList.remove('open');
    });

    if (avatarBtn) {
      avatarBtn.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape') menu.classList.remove('open');
        if(e.key === 'Enter' || e.key === ' '){
          e.preventDefault();
          toggle(!menu.classList.contains('open'));
        }
      });
    }
  });
});
</script>
{% endblock %}
</body>
</html>
