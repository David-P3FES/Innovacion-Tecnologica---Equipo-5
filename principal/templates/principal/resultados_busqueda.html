{% extends "base.html" %}
{% load humanize %}

{% block content %}
<div style="max-width:1200px;margin:1.25rem auto;">
  <h1 style="margin:0 0 .75rem;">Resultados de búsqueda</h1>

  <form method="get" action="{% url 'principal:resultados_busqueda' %}" style="display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1rem;">
    <select name="tipo_operacion" style="padding:.5rem .6rem;border:1px solid #ddd;border-radius:.5rem;">
      <option value="" {% if not tipo_sel %}selected{% endif %}>Tipo (todos)</option>
      <option value="venta" {% if tipo_sel == "venta" %}selected{% endif %}>Venta</option>
      <option value="renta" {% if tipo_sel == "renta" %}selected{% endif %}>Renta</option>
    </select>
    <input type="text" name="direccion" value="{{ q }}" placeholder="Dirección, ciudad o colonia"
           style="flex:1;min-width:240px;padding:.5rem .6rem;border:1px solid #ddd;border-radius:.5rem;">
    <button type="submit" style="padding:.5rem .9rem;border:none;border-radius:.5rem;background:#333;color:#fff;">Buscar</button>
    <a href="{% url 'principal:resultados_busqueda' %}" style="padding:.5rem .9rem;border:1px solid #ddd;border-radius:.5rem;background:#f7f7f7;color:#222;text-decoration:none;">Limpiar</a>
  </form>

  <p style="color:#666;margin:.25rem 0 1rem;">
    Se encontraron <strong>{{ total }}</strong> resultados{% if q %} para “{{ q }}”{% endif %}{% if tipo_sel %} en {{ tipo_sel }}{% endif %}.
  </p>

  {% if page_obj.object_list %}
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;">
      {% for pub in page_obj.object_list %}
        <article style="border:1px solid #eee;border-radius:12px;overflow:hidden;background:#fff;">
          <div style="height:180px;background:#f5f5f5;display:flex;align-items:center;justify-content:center;">
            {% with portada=pub.foto_portada %}
              {% if portada %}
                <img src="{{ portada.imagen.url }}" alt="{{ pub.titulo }}" style="width:100%;height:100%;object-fit:cover;">
              {% else %}
                <span style="color:#777;">Sin foto</span>
              {% endif %}
            {% endwith %}
          </div>
          <div style="padding:.8rem;">
            <div style="display:flex;justify-content:space-between;gap:.5rem;align-items:center;">
              <h3 style="margin:0;font-size:1.05rem;">{{ pub.titulo }}</h3>
              <span style="background:#eef;border-radius:.4rem;padding:.15rem .4rem;font-size:.8rem;text-transform:capitalize;">
                {{ pub.get_tipo_operacion_display }}
              </span>
            </div>
            <div style="font-weight:700;margin-top:.25rem;">${{ pub.precio|floatformat:0|intcomma }}</div>
            <div style="color:#444;margin-top:.25rem;">{{ pub.direccion_completa }}</div>
          </div>
        </article>
      {% endfor %}
    </div>

    <div style="display:flex;justify-content:center;gap:.5rem;margin:1rem 0;">
      {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}&tipo_operacion={{ tipo_sel }}&direccion={{ q|urlencode }}" style="padding:.35rem .6rem;border:1px solid #ddd;border-radius:.4rem;text-decoration:none;color:#222;">« Anterior</a>
      {% endif %}
      <span style="padding:.35rem .6rem;border:1px solid #ddd;border-radius:.4rem;background:#f6f6f6;">
        Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
      </span>
      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}&tipo_operacion={{ tipo_sel }}&direccion={{ q|urlencode }}" style="padding:.35rem .6rem;border:1px solid #ddd;border-radius:.4rem;text-decoration:none;color:#222;">Siguiente »</a>
      {% endif %}
    </div>
  {% else %}
    <div style="background:#fff;border:1px dashed #ddd;border-radius:12px;padding:1.25rem;">
      <p style="margin:0 0 .5rem;">No encontramos resultados.</p>
      <ul style="margin:.25rem 0 0 1rem;color:#555;">
        <li>Prueba con el nombre de la <b>colonia</b> o <b>ciudad</b>.</li>
        <li>Usa términos como “Centro”, “Juárez”, “Chihuahua”, “San Pedro”.</li>
      </ul>
    </div>
  {% endif %}
</div>
{% endblock %}
